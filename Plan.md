# 多人連線聊天室: 大綱

## 專案執行藍圖：多人連線聊天室

### 一、專案概述與目標定位

**專案願景**：開發一個展現紮實網路程式設計能力的多人聊天系統，體現對TCP/IP協定、並發處理、系統程式設計的掌握度。

**核心價值主張**：
- 展現低階系統程式設計能力（C語言）
- 體現網路協定與Socket程式設計的理解
- 展示並發處理與資源管理能力
- 證明程式架構設計與模組化思維

### 二、開發階段規劃（6個階段）

#### **Phase 1: 基礎架構建立（2週）**
**目標**：建立專案基礎結構與簡單的TCP連線

**工作項目**：
- 建立專案目錄結構與Makefile
- 實作基本的TCP Server（單一連線）
- 實作簡單的TCP Client
- 建立基本的錯誤處理機制
- 實作簡單的echo功能測試

**驗證成果**：
- Server能在指定port監聽
- Client能連線並發送訊息
- Server收到訊息後echo回Client
- 可在Linux/Windows跨平台測試

#### **Phase 2: 多客戶端連線管理（2-3週）**
**目標**：升級為多客戶端架構

**工作項目**：
- 實作多執行緒（pthread）或select/epoll機制
- 建立客戶端連線池管理
- 實作客戶端資料結構（ID、暱稱、socket fd等）
- 新增連線/斷線通知機制
- 實作基本的記憶體管理

**驗證成果**：
- 支援至少10個同時連線
- Server顯示當前連線數
- 客戶端斷線時正確清理資源
- 壓力測試：快速連線/斷線不會造成崩潰

#### **Phase 3: 訊息廣播系統（2週）**
**目標**：實現群組訊息廣播功能

**工作項目**：
- 設計訊息協定格式（header + payload）
- 實作訊息佇列機制
- 建立廣播邏輯（排除發送者）
- 加入時間戳記與使用者識別
- 實作訊息緩衝區管理

**驗證成果**：
- 任一客戶端發送的訊息能被所有其他客戶端接收
- 訊息包含發送者資訊與時間
- 大量訊息測試（每秒100則）
- 訊息順序保證機制驗證

#### **Phase 4: 私訊與指令系統（2-3週）**
**目標**：加入點對點通訊與指令解析

**工作項目**：
- 設計並實作指令解析器（/whisper, /list, /help等）
- 實作私訊路由機制
- 建立使用者查詢功能
- 加入訊息類型區分（系統/廣播/私訊）
- 實作指令回應機制

**驗證成果**：
- /list 顯示所有線上使用者
- /whisper [user] [msg] 發送私訊
- /help 顯示所有可用指令
- 私訊不會被其他使用者看到
- 錯誤指令的友善提示

#### **Phase 5: 進階功能與穩定性（3週）**
**目標**：提升系統穩定性與使用體驗

**工作項目**：
- 實作聊天室功能（多個房間）
- 加入使用者認證機制（簡單密碼）
- 實作訊息歷史記錄（檔案或記憶體）
- 加入心跳機制（keep-alive）
- 實作斷線重連機制
- 完善的日誌系統

**驗證成果**：
- 可建立/加入/離開聊天室
- 簡單的登入驗證
- 新加入使用者可看到最近N則訊息
- 網路不穩定時的自動重連
- 詳細的Server端日誌記錄

#### **Phase 6: 優化與部署（2週）**
**目標**：效能優化與專業化

**工作項目**：
- 效能分析與優化（valgrind、gprof）
- 實作配置檔系統
- 加入單元測試
- 撰寫API文件
- 建立Docker容器（選擇性）
- 實作簡單的Web監控介面（選擇性）

**驗證成果**：
- 記憶體洩漏檢測通過
- 支援100+同時連線
- 完整的使用手冊
- 自動化測試腳本
- 效能報告與分析

### 三、程式架構與檔案配置

```
chat-server/
│
├── Makefile                 # 建置設定
├── README.md               # 專案說明文件
├── config/                 # 設定檔目錄
│   └── server.conf        # 伺服器設定檔
│
├── src/                    # 原始碼目錄
│   ├── server/            # 伺服器端程式碼
│   │   ├── main.c         # 主程式進入點
│   │   ├── server.c       # 伺服器核心邏輯
│   │   ├── server.h       
│   │   ├── connection.c   # 連線管理
│   │   ├── connection.h   
│   │   ├── message.c      # 訊息處理
│   │   ├── message.h      
│   │   ├── room.c         # 聊天室管理
│   │   ├── room.h         
│   │   └── command.c      # 指令處理
│   │   └── command.h      
│   │
│   ├── client/            # 客戶端程式碼
│   │   ├── main.c         # 客戶端主程式
│   │   ├── client.c       # 客戶端核心邏輯
│   │   ├── client.h       
│   │   ├── ui.c           # 使用者介面
│   │   └── ui.h           
│   │
│   ├── common/            # 共用模組
│   │   ├── protocol.h     # 通訊協定定義
│   │   ├── protocol.c     
│   │   ├── utils.c        # 工具函數
│   │   ├── utils.h        
│   │   ├── logger.c       # 日誌系統
│   │   └── logger.h       
│   │
│   └── test/              # 測試程式碼
│       ├── test_server.c  
│       ├── test_client.c  
│       └── test_protocol.c
│
├── docs/                   # 文件目錄
│   ├── API.md             # API說明
│   ├── PROTOCOL.md        # 協定規格
│   └── ARCHITECTURE.md   # 架構說明
│
├── scripts/               # 輔助腳本
│   ├── stress_test.sh    # 壓力測試
│   └── deploy.sh         # 部署腳本
│
└── logs/                  # 日誌目錄
    └── server.log
```

### 四、各檔案功能定位說明

#### Server端核心模組：

**server.c/h**
- 主要的伺服器邏輯控制
- 初始化Socket、綁定、監聽
- 主事件循環（select/epoll）
- 協調各模組運作

**connection.c/h**
- 客戶端連線池管理
- 處理新連線、斷線
- 維護客戶端狀態資訊
- 執行緒/程序管理

**message.c/h**
- 訊息佇列實作
- 訊息路由邏輯
- 廣播與單播實作
- 訊息序列化/反序列化

**room.c/h**
- 聊天室的建立與管理
- 使用者加入/離開房間
- 房間內訊息分發
- 房間狀態維護

**command.c/h**
- 指令解析引擎
- 指令執行邏輯
- 指令權限檢查
- 回應訊息生成

#### Client端模組：

**client.c/h**
- 連線建立與維護
- 訊息收發處理
- 重連機制
- 本地狀態管理

**ui.c/h**
- 終端介面處理
- 輸入輸出格式化
- 非阻塞輸入處理
- 顏色與格式支援

#### 共用模組：

**protocol.c/h**
- 定義訊息格式結構
- 協定版本管理
- 封包編碼/解碼
- 錯誤碼定義

**utils.c/h**
- 字串處理函數
- 時間處理
- 網路工具函數
- 資料結構（鏈結串列、雜湊表等）

**logger.c/h**
- 日誌等級管理
- 檔案/終端輸出
- 日誌輪轉
- 效能統計

### 五、技術棧與開發工具建議

**核心技術**：
- Socket Programming (TCP/IP)
- POSIX Threads (pthread)
- I/O Multiplexing (select/poll/epoll)
- Signal Handling
- IPC (Inter-Process Communication)

**開發工具**：
- 編譯器：gcc/clang
- 偵錯器：gdb
- 記憶體檢測：valgrind
- 效能分析：gprof, perf
- 版本控制：git
- 建置工具：GNU Make/CMake

**測試工具**：
- 單元測試：Unity或自製簡單框架
- 網路測試：nc (netcat), telnet
- 壓力測試：自製腳本或Apache Bench改造

### 六、面試展示重點

**架構設計能力**：
- 模組化設計思維
- 介面與實作分離
- 可擴展性考量

**技術深度展現**：
- 並發模型選擇（多執行緒 vs I/O多工）
- 記憶體管理策略
- 錯誤處理機制
- 網路異常處理

**工程實務**：
- 完整的文件
- 版本控制歷程
- 測試覆蓋
- 效能優化過程

**進階特色**（加分項）：
- 訊息加密（簡單XOR或AES）
- 檔案傳輸功能
- 表情符號支援
- 訊息持久化（SQLite）

